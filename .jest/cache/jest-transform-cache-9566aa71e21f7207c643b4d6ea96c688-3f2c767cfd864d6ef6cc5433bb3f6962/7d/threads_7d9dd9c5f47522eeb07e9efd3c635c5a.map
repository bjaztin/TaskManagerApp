{"version":3,"names":["_NativeReanimated","_interopRequireDefault","require","_PlatformChecker","_shareables","IS_JEST","isJest","IS_WEB","shouldBeUseWeb","_runOnUIQueue","_worklet_15487039925692_init_data","code","location","sourceMap","setupMicrotasks","_e","global","Error","_f","microtasksQueue","isExecutingMicrotasksQueue","queueMicrotask","callback","push","__callMicrotasks","index","length","_maybeFlushUIUpdatesQueue","_closure","__initData","__workletHash","__stackDetails","__version","exports","_worklet_9338539058190_init_data","callMicrotasksOnUIThread","callMicrotasks","_worklet_6075541312704_init_data","_worklet_9052027840618_init_data","_worklet_15920347530628_init_data","runOnUI","worklet","__DEV__","_WORKLET","undefined","_len","arguments","args","Array","_key","NativeReanimatedModule","scheduleOnUI","makeShareableCloneRecursive","apply","queue","forEach","_ref","_ref2","_slicedToArray2","default","_toConsumableArray2","_worklet_5355002833846_init_data","_worklet_9052027840618_init_data2","runOnUIImmediately","_len2","_key2","f","_worklet_16556756009009_init_data","_worklet_7336242302191_init_data","runOnJS","fun","__remoteFunction","_len3","_key3","_scheduleOnJS","makeShareableCloneOnUIRecursive"],"sources":["threads.ts"],"sourcesContent":["import NativeReanimatedModule from './NativeReanimated';\nimport { isJest, shouldBeUseWeb } from './PlatformChecker';\nimport { ComplexWorkletFunction } from './commonTypes';\nimport {\n  makeShareableCloneOnUIRecursive,\n  makeShareableCloneRecursive,\n} from './shareables';\n\nconst IS_JEST = isJest();\nconst IS_WEB = shouldBeUseWeb();\n\nlet _runOnUIQueue: Array<[ComplexWorkletFunction<any[], any>, any[]]> = [];\n\nexport function setupMicrotasks() {\n  'worklet';\n\n  let microtasksQueue: Array<() => void> = [];\n  let isExecutingMicrotasksQueue = false;\n\n  // @ts-ignore â€“ typescript expects this to conform to NodeJS definition and expects the return value to be NodeJS.Immediate which is an object and not a number\n  global.queueMicrotask = (callback: () => void): number => {\n    microtasksQueue.push(callback);\n    return -1;\n  };\n\n  global.__callMicrotasks = () => {\n    if (isExecutingMicrotasksQueue) {\n      return;\n    }\n    try {\n      isExecutingMicrotasksQueue = true;\n      for (let index = 0; index < microtasksQueue.length; index += 1) {\n        // we use classic 'for' loop because the size of the currentTasks array may change while executing some of the callbacks due to queueMicrotask calls\n        microtasksQueue[index]();\n      }\n      microtasksQueue = [];\n      global._maybeFlushUIUpdatesQueue();\n    } finally {\n      isExecutingMicrotasksQueue = false;\n    }\n  };\n}\n\nfunction callMicrotasksOnUIThread() {\n  'worklet';\n  global.__callMicrotasks();\n}\n\nexport const callMicrotasks = shouldBeUseWeb()\n  ? () => {\n      // on web flushing is a noop as immediates are handled by the browser\n    }\n  : callMicrotasksOnUIThread;\n\n/**\n * Schedule a worklet to execute on the UI runtime. This method does not schedule the work immediately but instead\n * waits for other worklets to be scheduled within the same JS loop. It uses queueMicrotask to schedule all the worklets\n * at once making sure they will run within the same frame boundaries on the UI thread.\n */\nexport function runOnUI<A extends any[], R>(\n  worklet: ComplexWorkletFunction<A, R>\n): (...args: A) => void {\n  'worklet';\n  if (__DEV__ && !IS_WEB && _WORKLET) {\n    throw new Error(\n      'runOnUI() cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.'\n    );\n  }\n  if (__DEV__ && !IS_WEB && worklet.__workletHash === undefined) {\n    throw new Error('runOnUI() can only be used on worklets');\n  }\n  return (...args) => {\n    if (IS_JEST) {\n      // Mocking time in Jest is tricky as both requestAnimationFrame and queueMicrotask\n      // callbacks run on the same queue and can be interleaved. There is no way\n      // to flush particular queue in Jest and the only control over mocked timers\n      // is by using jest.advanceTimersByTime() method which advances all types\n      // of timers including immediate and animation callbacks. Ideally we'd like\n      // to have some way here to schedule work along with React updates, but\n      // that's not possible, and hence in Jest environment instead of using scheduling\n      // mechanism we just schedule the work ommiting the queue. This is ok for the\n      // uses that we currently have but may not be ok for future tests that we write.\n      NativeReanimatedModule.scheduleOnUI(\n        makeShareableCloneRecursive(() => {\n          'worklet';\n          worklet(...args);\n        })\n      );\n      return;\n    }\n    if (__DEV__) {\n      // in DEV mode we call shareable conversion here because in case the object\n      // can't be converted, we will get a meaningful stack-trace as opposed to the\n      // situation when conversion is only done via microtask queue. This does not\n      // make the app particularily less efficient as converted objects are cached\n      // and for a given worklet the conversion only happens once.\n      makeShareableCloneRecursive(worklet);\n      makeShareableCloneRecursive(args);\n    }\n    _runOnUIQueue.push([worklet, args]);\n    if (_runOnUIQueue.length === 1) {\n      queueMicrotask(() => {\n        const queue = _runOnUIQueue;\n        _runOnUIQueue = [];\n        NativeReanimatedModule.scheduleOnUI(\n          makeShareableCloneRecursive(() => {\n            'worklet';\n            queue.forEach(([worklet, args]) => {\n              worklet(...args);\n            });\n            callMicrotasks();\n          })\n        );\n      });\n    }\n  };\n}\n\n/**\n * Schedule a worklet to execute on the UI runtime skipping batching mechanism.\n */\nexport function runOnUIImmediately<A extends any[], R>(\n  worklet: ComplexWorkletFunction<A, R>\n): (...args: A) => void {\n  'worklet';\n  if (__DEV__ && !IS_WEB && _WORKLET) {\n    throw new Error(\n      'runOnUIImmediately() cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.'\n    );\n  }\n  if (__DEV__ && !IS_WEB && worklet.__workletHash === undefined) {\n    throw new Error('runOnUIImmediately() can only be used on worklets');\n  }\n  return (...args) => {\n    NativeReanimatedModule.scheduleOnUI(\n      makeShareableCloneRecursive(() => {\n        'worklet';\n        worklet(...args);\n      })\n    );\n  };\n}\n\nif (__DEV__ && !IS_WEB) {\n  const f = () => {\n    'worklet';\n  };\n  // @ts-ignore plugin\n  if (f.__workletHash === undefined) {\n    throw new Error(\n      'Failed to create a worklet. Did you forget to add Reanimated Babel plugin in babel.config.js? See installation docs at https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation#babel-plugin.'\n    );\n  }\n}\n\nexport function runOnJS<A extends any[], R>(\n  fun: ComplexWorkletFunction<A, R>\n): (...args: A) => void {\n  'worklet';\n  if (fun.__remoteFunction) {\n    // in development mode the function provided as `fun` throws an error message\n    // such that when someone accidently calls it directly on the UI runtime, they\n    // see that they should use `runOnJS` instead. To facilitate that we purt the\n    // reference to the original remote function in the `__remoteFunction` property.\n    fun = fun.__remoteFunction;\n  }\n  if (!_WORKLET) {\n    return fun;\n  }\n  return (...args) => {\n    _scheduleOnJS(\n      fun,\n      args.length > 0 ? makeShareableCloneOnUIRecursive(args) : undefined\n    );\n  };\n}\n"],"mappings":"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"}