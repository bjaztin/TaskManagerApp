{"version":3,"names":["_mappers","require","_worklet_16665543178482_init_data","code","location","sourceMap","valueSetter","_e","global","Error","_f","sv","value","previousAnimation","_animation","cancelled","onFrame","undefined","animation","_value","current","isHigherOrder","callback","initializeAnimation","timestamp","onStart","currentTimestamp","__frameTimestamp","performance","now","step","finished","requestAnimationFrame","_closure","__initData","__workletHash","__stackDetails","__version","exports"],"sources":["valueSetter.ts"],"sourcesContent":["import { AnimationObject, AnimatableValue } from './commonTypes';\nimport { Descriptor } from './hook/commonTypes';\nexport { stopMapper } from './mappers';\n\nexport function valueSetter(sv: any, value: any): void {\n  'worklet';\n  const previousAnimation = sv._animation;\n  if (previousAnimation) {\n    previousAnimation.cancelled = true;\n    sv._animation = null;\n  }\n  if (\n    typeof value === 'function' ||\n    (value !== null &&\n      typeof value === 'object' &&\n      (value as AnimationObject).onFrame !== undefined)\n  ) {\n    const animation: AnimationObject =\n      typeof value === 'function'\n        ? (value as () => AnimationObject)()\n        : (value as AnimationObject);\n    // prevent setting again to the same value\n    // and triggering the mappers that treat this value as an input\n    // this happens when the animation's target value(stored in animation.current until animation.onStart is called) is set to the same value as a current one(this._value)\n    // built in animations that are not higher order(withTiming, withSpring) hold target value in .current\n    if (sv._value === animation.current && !animation.isHigherOrder) {\n      animation.callback && animation.callback(true);\n      return;\n    }\n    // animated set\n    const initializeAnimation = (timestamp: number) => {\n      animation.onStart(animation, sv.value, timestamp, previousAnimation);\n    };\n    const currentTimestamp = global.__frameTimestamp || performance.now();\n    initializeAnimation(currentTimestamp);\n    const step = (timestamp: number) => {\n      if (animation.cancelled) {\n        animation.callback && animation.callback(false /* finished */);\n        return;\n      }\n      const finished = animation.onFrame(animation, timestamp);\n      animation.finished = true;\n      animation.timestamp = timestamp;\n      sv._value = animation.current;\n      if (finished) {\n        animation.callback && animation.callback(true /* finished */);\n      } else {\n        requestAnimationFrame(step);\n      }\n    };\n\n    sv._animation = animation;\n\n    step(currentTimestamp);\n  } else {\n    // prevent setting again to the same value\n    // and triggering the mappers that treat this value as an input\n    if (sv._value === value) {\n      return;\n    }\n    sv._value = value as Descriptor | AnimatableValue;\n  }\n}\n"],"mappings":";;;;;;;;;;AAEA,IAAAA,QAAA,GAAAC,OAAA;AAAsC,IAAAC,iCAAA;EAAAC,IAAA;EAAAC,QAAA;EAAAC,SAAA;AAAA;AAAA,IAEtBC,WAAW;EAAA,IAAAC,EAAA,QAAAC,MAAA,CAAAC,KAAA;EAAA,IAAAC,EAAA,YAAAA,GAACC,EAAO,EAAEC,KAAU,EAAQ;IAErD,IAAMC,iBAAiB,GAAGF,EAAE,CAACG,UAAU;IACvC,IAAID,iBAAiB,EAAE;MACrBA,iBAAiB,CAACE,SAAS,GAAG,IAAI;MAClCJ,EAAE,CAACG,UAAU,GAAG,IAAI;IACtB;IACA,IACE,OAAOF,KAAK,KAAK,UAAU,IAC1BA,KAAK,KAAK,IAAI,IACb,OAAOA,KAAK,KAAK,QAAQ,IACxBA,KAAK,CAAqBI,OAAO,KAAKC,SAAU,EACnD;MACA,IAAMC,SAA0B,GAC9B,OAAON,KAAK,KAAK,UAAU,GACtBA,KAAK,EAA4B,GACjCA,KAAyB;MAKhC,IAAID,EAAE,CAACQ,MAAM,KAAKD,SAAS,CAACE,OAAO,IAAI,CAACF,SAAS,CAACG,aAAa,EAAE;QAC/DH,SAAS,CAACI,QAAQ,IAAIJ,SAAS,CAACI,QAAQ,CAAC,IAAI,CAAC;QAC9C;MACF;MAEA,IAAMC,mBAAmB,GAAI,SAAvBA,mBAAmBA,CAAIC,SAAiB,EAAK;QACjDN,SAAS,CAACO,OAAO,CAACP,SAAS,EAAEP,EAAE,CAACC,KAAK,EAAEY,SAAS,EAAEX,iBAAiB,CAAC;MACtE,CAAC;MACD,IAAMa,gBAAgB,GAAGlB,MAAM,CAACmB,gBAAgB,IAAIC,WAAW,CAACC,GAAG,EAAE;MACrEN,mBAAmB,CAACG,gBAAgB,CAAC;MACrC,IAAMI,IAAI,GAAI,SAARA,IAAIA,CAAIN,SAAiB,EAAK;QAClC,IAAIN,SAAS,CAACH,SAAS,EAAE;UACvBG,SAAS,CAACI,QAAQ,IAAIJ,SAAS,CAACI,QAAQ,CAAC,KAAM,CAAe;UAC9D;QACF;QACA,IAAMS,QAAQ,GAAGb,SAAS,CAACF,OAAO,CAACE,SAAS,EAAEM,SAAS,CAAC;QACxDN,SAAS,CAACa,QAAQ,GAAG,IAAI;QACzBb,SAAS,CAACM,SAAS,GAAGA,SAAS;QAC/Bb,EAAE,CAACQ,MAAM,GAAGD,SAAS,CAACE,OAAO;QAC7B,IAAIW,QAAQ,EAAE;UACZb,SAAS,CAACI,QAAQ,IAAIJ,SAAS,CAACI,QAAQ,CAAC,IAAK,CAAe;QAC/D,CAAC,MAAM;UACLU,qBAAqB,CAACF,IAAI,CAAC;QAC7B;MACF,CAAC;MAEDnB,EAAE,CAACG,UAAU,GAAGI,SAAS;MAEzBY,IAAI,CAACJ,gBAAgB,CAAC;IACxB,CAAC,MAAM;MAGL,IAAIf,EAAE,CAACQ,MAAM,KAAKP,KAAK,EAAE;QACvB;MACF;MACAD,EAAE,CAACQ,MAAM,GAAGP,KAAqC;IACnD;EACF;EAAAF,EAAA,CAAAuB,QAAA;EAAAvB,EAAA,CAAAwB,UAAA,GAAAhC,iCAAA;EAAAQ,EAAA,CAAAyB,aAAA;EAAAzB,EAAA,CAAA0B,cAAA,GAAA7B,EAAA;EAAAG,EAAA,CAAA2B,SAAA;EAAA,OAAA3B,EAAA;AAAA;AAAA4B,OAAA,CAAAhC,WAAA,GAAAA,WAAA"}