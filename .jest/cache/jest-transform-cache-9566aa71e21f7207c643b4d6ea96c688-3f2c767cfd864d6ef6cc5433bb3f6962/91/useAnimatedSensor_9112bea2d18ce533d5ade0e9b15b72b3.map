{"version":3,"names":["_react","require","_core","_commonTypes","_threads","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","_worklet_16207379104934_init_data","code","location","sourceMap","eulerToQuaternion","_e","global","Error","_f","pitch","roll","yaw","c1","Math","cos","s1","sin","c2","s2","c3","s3","_closure","__initData","__workletHash","__stackDetails","__version","_worklet_4985018991112_init_data","adjustRotationToInterfaceOrientation","data","interfaceOrientation","PI","q","qx","qy","qz","qw","adjustVectorToInterfaceOrientation","x","y","_worklet_12606310302424_init_data","_worklet_16054857555903_init_data","useAnimatedSensor","sensorType","userConfig","config","interval","adjustToInterfaceOrientation","iosReferenceFrame","IOSReferenceFrame","Auto","ref","useRef","sensor","initializeSensor","unregister","isAvailable","useEffect","newConfig","current","sensorData","id","registerSensor","SensorType","ROTATION","value","callMicrotasks","unregisterSensor"],"sources":["useAnimatedSensor.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { initializeSensor, registerSensor, unregisterSensor } from '../core';\nimport {\n  SensorType,\n  IOSReferenceFrame,\n  SensorConfig,\n  AnimatedSensor,\n  Value3D,\n  ValueRotation,\n} from '../commonTypes';\nimport { callMicrotasks } from '../threads';\n\n// euler angles are in order ZXY, z = yaw, x = pitch, y = roll\n// https://github.com/mrdoob/three.js/blob/dev/src/math/Quaternion.js#L237\nfunction eulerToQuaternion(pitch: number, roll: number, yaw: number) {\n  'worklet';\n  const c1 = Math.cos(pitch / 2);\n  const s1 = Math.sin(pitch / 2);\n  const c2 = Math.cos(roll / 2);\n  const s2 = Math.sin(roll / 2);\n  const c3 = Math.cos(yaw / 2);\n  const s3 = Math.sin(yaw / 2);\n\n  return [\n    s1 * c2 * c3 - c1 * s2 * s3,\n    c1 * s2 * c3 + s1 * c2 * s3,\n    c1 * c2 * s3 + s1 * s2 * c3,\n    c1 * c2 * c3 - s1 * s2 * s3,\n  ];\n}\n\nfunction adjustRotationToInterfaceOrientation(data: ValueRotation) {\n  'worklet';\n  const { interfaceOrientation, pitch, roll, yaw } = data;\n  if (interfaceOrientation === 90) {\n    data.pitch = roll;\n    data.roll = -pitch;\n    data.yaw = yaw - Math.PI / 2;\n  } else if (interfaceOrientation === 270) {\n    data.pitch = -roll;\n    data.roll = pitch;\n    data.yaw = yaw + Math.PI / 2;\n  } else if (interfaceOrientation === 180) {\n    data.pitch *= -1;\n    data.roll *= -1;\n    data.yaw *= -1;\n  }\n\n  const q = eulerToQuaternion(data.pitch, data.roll, data.yaw);\n  data.qx = q[0];\n  data.qy = q[1];\n  data.qz = q[2];\n  data.qw = q[3];\n  return data;\n}\n\nfunction adjustVectorToInterfaceOrientation(data: Value3D) {\n  'worklet';\n  const { interfaceOrientation, x, y } = data;\n  if (interfaceOrientation === 90) {\n    data.x = -y;\n    data.y = x;\n  } else if (interfaceOrientation === 270) {\n    data.x = y;\n    data.y = -x;\n  } else if (interfaceOrientation === 180) {\n    data.x *= -1;\n    data.y *= -1;\n  }\n  return data;\n}\n\nexport function useAnimatedSensor(\n  sensorType: SensorType,\n  userConfig?: Partial<SensorConfig>\n): AnimatedSensor {\n  const config: SensorConfig = {\n    interval: 'auto',\n    adjustToInterfaceOrientation: true,\n    iosReferenceFrame: IOSReferenceFrame.Auto,\n    ...userConfig,\n  };\n  const ref = useRef<AnimatedSensor>({\n    sensor: initializeSensor(sensorType, config),\n    unregister: () => {\n      // NOOP\n    },\n    isAvailable: false,\n    config: config,\n  });\n\n  useEffect(() => {\n    const newConfig = {\n      ...config,\n      ...userConfig,\n    };\n    ref.current.sensor = initializeSensor(sensorType, newConfig);\n\n    const sensorData = ref.current.sensor;\n    const adjustToInterfaceOrientation =\n      ref.current.config.adjustToInterfaceOrientation;\n\n    const id = registerSensor(sensorType, config, (data) => {\n      'worklet';\n      if (adjustToInterfaceOrientation) {\n        if (sensorType === SensorType.ROTATION) {\n          data = adjustRotationToInterfaceOrientation(data as ValueRotation);\n        } else {\n          data = adjustVectorToInterfaceOrientation(data as Value3D);\n        }\n      }\n      sensorData.value = data;\n      callMicrotasks();\n    });\n\n    if (id !== -1) {\n      // if sensor is available\n      ref.current.unregister = () => unregisterSensor(id);\n      ref.current.isAvailable = true;\n    } else {\n      // if sensor is unavailable\n      ref.current.unregister = () => {\n        // NOOP\n      };\n      ref.current.isAvailable = false;\n    }\n\n    return () => {\n      ref.current.unregister();\n    };\n  }, [sensorType, userConfig]);\n\n  return ref.current;\n}\n"],"mappings":"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"}