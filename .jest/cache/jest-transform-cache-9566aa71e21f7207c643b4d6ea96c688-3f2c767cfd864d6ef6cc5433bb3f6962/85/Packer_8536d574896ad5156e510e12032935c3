d8397ed27a1a7eddbc060009643d6936
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.HOUR_BLOCK_HEIGHT = void 0;
exports.buildUnavailableHoursBlocks = buildUnavailableHoursBlocks;
exports.populateEvents = populateEvents;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _inRange = _interopRequireDefault(require("lodash/inRange"));
var _xdate = _interopRequireDefault(require("xdate"));
var _constants = _interopRequireDefault(require("../commons/constants"));
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var HOUR_BLOCK_HEIGHT = 100;
exports.HOUR_BLOCK_HEIGHT = HOUR_BLOCK_HEIGHT;
var OVERLAP_EVENTS_SPACINGS = 10;
var RIGHT_EDGE_SPACING = 10;
function buildEvent(event, left, width, _ref) {
  var _ref$dayStart = _ref.dayStart,
    dayStart = _ref$dayStart === void 0 ? 0 : _ref$dayStart,
    _ref$hourBlockHeight = _ref.hourBlockHeight,
    hourBlockHeight = _ref$hourBlockHeight === void 0 ? HOUR_BLOCK_HEIGHT : _ref$hourBlockHeight;
  var startTime = new _xdate.default(event.start);
  var endTime = event.end ? new _xdate.default(event.end) : new _xdate.default(startTime).addHours(1);
  var dayStartTime = new _xdate.default(startTime).clearTime();
  return _objectSpread(_objectSpread({}, event), {}, {
    top: (dayStartTime.diffHours(startTime) - dayStart) * hourBlockHeight,
    height: startTime.diffHours(endTime) * hourBlockHeight,
    width: width,
    left: left
  });
}
function hasCollision(a, b) {
  return a.end > b.start && a.start < b.end;
}
function calcColumnSpan(event, columnIndex, columns) {
  var colSpan = 1;
  for (var i = columnIndex + 1; i < columns.length; i++) {
    var column = columns[i];
    var foundCollision = column.find(function (ev) {
      return hasCollision(event, ev);
    });
    if (foundCollision) {
      return colSpan;
    }
    colSpan++;
  }
  return colSpan;
}
function packOverlappingEventGroup(columns, calculatedEvents, populateOptions) {
  var _populateOptions$scre = populateOptions.screenWidth,
    screenWidth = _populateOptions$scre === void 0 ? _constants.default.screenWidth : _populateOptions$scre,
    _populateOptions$righ = populateOptions.rightEdgeSpacing,
    rightEdgeSpacing = _populateOptions$righ === void 0 ? RIGHT_EDGE_SPACING : _populateOptions$righ,
    _populateOptions$over = populateOptions.overlapEventsSpacing,
    overlapEventsSpacing = _populateOptions$over === void 0 ? OVERLAP_EVENTS_SPACINGS : _populateOptions$over;
  columns.forEach(function (column, columnIndex) {
    column.forEach(function (event) {
      var totalWidth = screenWidth - rightEdgeSpacing;
      var columnSpan = calcColumnSpan(event, columnIndex, columns);
      var eventLeft = columnIndex / columns.length * totalWidth;
      var eventWidth = totalWidth * (columnSpan / columns.length);
      if (columnIndex + columnSpan <= columns.length - 1) {
        eventWidth -= overlapEventsSpacing;
      }
      calculatedEvents.push(buildEvent(event, eventLeft, eventWidth, populateOptions));
    });
  });
}
function populateEvents(_events, populateOptions) {
  var lastEnd = null;
  var columns = [];
  var calculatedEvents = [];
  var events = _events.map(function (ev, index) {
    return _objectSpread(_objectSpread({}, ev), {}, {
      index: index
    });
  }).sort(function (a, b) {
    if (a.start < b.start) return -1;
    if (a.start > b.start) return 1;
    if (a.end < b.end) return -1;
    if (a.end > b.end) return 1;
    return 0;
  });
  events.forEach(function (ev) {
    if (lastEnd !== null && ev.start >= lastEnd) {
      packOverlappingEventGroup(columns, calculatedEvents, populateOptions);
      columns = [];
      lastEnd = null;
    }
    var placed = false;
    for (var i = 0; i < columns.length; i++) {
      var col = columns[i];
      if (!hasCollision(col[col.length - 1], ev)) {
        col.push(ev);
        placed = true;
        break;
      }
    }
    if (!placed) {
      columns.push([ev]);
    }
    if (lastEnd === null || ev.end > lastEnd) {
      lastEnd = ev.end;
    }
  });
  if (columns.length > 0) {
    packOverlappingEventGroup(columns, calculatedEvents, populateOptions);
  }
  return calculatedEvents;
}
function buildUnavailableHoursBlocks() {
  var unavailableHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
  var options = arguments.length > 1 ? arguments[1] : undefined;
  var _ref2 = options || {},
    _ref2$hourBlockHeight = _ref2.hourBlockHeight,
    hourBlockHeight = _ref2$hourBlockHeight === void 0 ? HOUR_BLOCK_HEIGHT : _ref2$hourBlockHeight,
    _ref2$dayStart = _ref2.dayStart,
    dayStart = _ref2$dayStart === void 0 ? 0 : _ref2$dayStart,
    _ref2$dayEnd = _ref2.dayEnd,
    dayEnd = _ref2$dayEnd === void 0 ? 24 : _ref2$dayEnd;
  var totalDayHours = dayEnd - dayStart;
  var totalDayHeight = (dayEnd - dayStart) * hourBlockHeight;
  return unavailableHours.map(function (hours) {
    if (!(0, _inRange.default)(hours.start, 0, 25) || !(0, _inRange.default)(hours.end, 0, 25)) {
      console.error('Calendar Timeline unavailableHours is invalid. Hours should be between 0 and 24');
      return undefined;
    }
    if (hours.start >= hours.end) {
      console.error('Calendar Timeline availableHours is invalid. start hour should be earlier than end hour');
      return undefined;
    }
    var startFixed = Math.max(hours.start, dayStart);
    var endFixed = Math.min(hours.end, dayEnd);
    return {
      top: (startFixed - dayStart) / totalDayHours * totalDayHeight,
      height: (endFixed - startFixed) * hourBlockHeight
    };
  }).filter(Boolean);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW5SYW5nZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3hkYXRlIiwiX2NvbnN0YW50cyIsIm93bktleXMiLCJlIiwiciIsInQiLCJPYmplY3QiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwibyIsImZpbHRlciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJkZWZhdWx0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJkZWZpbmVQcm9wZXJ0eSIsIkhPVVJfQkxPQ0tfSEVJR0hUIiwiZXhwb3J0cyIsIk9WRVJMQVBfRVZFTlRTX1NQQUNJTkdTIiwiUklHSFRfRURHRV9TUEFDSU5HIiwiYnVpbGRFdmVudCIsImV2ZW50IiwibGVmdCIsIndpZHRoIiwiX3JlZiIsIl9yZWYkZGF5U3RhcnQiLCJkYXlTdGFydCIsIl9yZWYkaG91ckJsb2NrSGVpZ2h0IiwiaG91ckJsb2NrSGVpZ2h0Iiwic3RhcnRUaW1lIiwiWERhdGUiLCJzdGFydCIsImVuZFRpbWUiLCJlbmQiLCJhZGRIb3VycyIsImRheVN0YXJ0VGltZSIsImNsZWFyVGltZSIsInRvcCIsImRpZmZIb3VycyIsImhlaWdodCIsImhhc0NvbGxpc2lvbiIsImEiLCJiIiwiY2FsY0NvbHVtblNwYW4iLCJjb2x1bW5JbmRleCIsImNvbHVtbnMiLCJjb2xTcGFuIiwiaSIsImNvbHVtbiIsImZvdW5kQ29sbGlzaW9uIiwiZmluZCIsImV2IiwicGFja092ZXJsYXBwaW5nRXZlbnRHcm91cCIsImNhbGN1bGF0ZWRFdmVudHMiLCJwb3B1bGF0ZU9wdGlvbnMiLCJfcG9wdWxhdGVPcHRpb25zJHNjcmUiLCJzY3JlZW5XaWR0aCIsImNvbnN0YW50cyIsIl9wb3B1bGF0ZU9wdGlvbnMkcmlnaCIsInJpZ2h0RWRnZVNwYWNpbmciLCJfcG9wdWxhdGVPcHRpb25zJG92ZXIiLCJvdmVybGFwRXZlbnRzU3BhY2luZyIsInRvdGFsV2lkdGgiLCJjb2x1bW5TcGFuIiwiZXZlbnRMZWZ0IiwiZXZlbnRXaWR0aCIsInBvcHVsYXRlRXZlbnRzIiwiX2V2ZW50cyIsImxhc3RFbmQiLCJldmVudHMiLCJtYXAiLCJpbmRleCIsInNvcnQiLCJwbGFjZWQiLCJjb2wiLCJidWlsZFVuYXZhaWxhYmxlSG91cnNCbG9ja3MiLCJ1bmF2YWlsYWJsZUhvdXJzIiwidW5kZWZpbmVkIiwib3B0aW9ucyIsIl9yZWYyIiwiX3JlZjIkaG91ckJsb2NrSGVpZ2h0IiwiX3JlZjIkZGF5U3RhcnQiLCJfcmVmMiRkYXlFbmQiLCJkYXlFbmQiLCJ0b3RhbERheUhvdXJzIiwidG90YWxEYXlIZWlnaHQiLCJob3VycyIsImluUmFuZ2UiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGFydEZpeGVkIiwiTWF0aCIsIm1heCIsImVuZEZpeGVkIiwibWluIiwiQm9vbGVhbiJdLCJzb3VyY2VzIjpbIlBhY2tlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgaW5SYW5nZSBmcm9tICdsb2Rhc2gvaW5SYW5nZSc7XG5pbXBvcnQgWERhdGUgZnJvbSAneGRhdGUnO1xuaW1wb3J0IGNvbnN0YW50cyBmcm9tICcuLi9jb21tb25zL2NvbnN0YW50cyc7XG5leHBvcnQgY29uc3QgSE9VUl9CTE9DS19IRUlHSFQgPSAxMDA7XG5jb25zdCBPVkVSTEFQX0VWRU5UU19TUEFDSU5HUyA9IDEwO1xuY29uc3QgUklHSFRfRURHRV9TUEFDSU5HID0gMTA7XG5mdW5jdGlvbiBidWlsZEV2ZW50KGV2ZW50LCBsZWZ0LCB3aWR0aCwgeyBkYXlTdGFydCA9IDAsIGhvdXJCbG9ja0hlaWdodCA9IEhPVVJfQkxPQ0tfSEVJR0hUIH0pIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgWERhdGUoZXZlbnQuc3RhcnQpO1xuICAgIGNvbnN0IGVuZFRpbWUgPSBldmVudC5lbmQgPyBuZXcgWERhdGUoZXZlbnQuZW5kKSA6IG5ldyBYRGF0ZShzdGFydFRpbWUpLmFkZEhvdXJzKDEpO1xuICAgIGNvbnN0IGRheVN0YXJ0VGltZSA9IG5ldyBYRGF0ZShzdGFydFRpbWUpLmNsZWFyVGltZSgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLmV2ZW50LFxuICAgICAgICB0b3A6IChkYXlTdGFydFRpbWUuZGlmZkhvdXJzKHN0YXJ0VGltZSkgLSBkYXlTdGFydCkgKiBob3VyQmxvY2tIZWlnaHQsXG4gICAgICAgIGhlaWdodDogc3RhcnRUaW1lLmRpZmZIb3VycyhlbmRUaW1lKSAqIGhvdXJCbG9ja0hlaWdodCxcbiAgICAgICAgd2lkdGgsXG4gICAgICAgIGxlZnRcbiAgICB9O1xufVxuZnVuY3Rpb24gaGFzQ29sbGlzaW9uKGEsIGIpIHtcbiAgICByZXR1cm4gYS5lbmQgPiBiLnN0YXJ0ICYmIGEuc3RhcnQgPCBiLmVuZDtcbn1cbmZ1bmN0aW9uIGNhbGNDb2x1bW5TcGFuKGV2ZW50LCBjb2x1bW5JbmRleCwgY29sdW1ucykge1xuICAgIGxldCBjb2xTcGFuID0gMTtcbiAgICBmb3IgKGxldCBpID0gY29sdW1uSW5kZXggKyAxOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBjb2x1bW5zW2ldO1xuICAgICAgICBjb25zdCBmb3VuZENvbGxpc2lvbiA9IGNvbHVtbi5maW5kKGV2ID0+IGhhc0NvbGxpc2lvbihldmVudCwgZXYpKTtcbiAgICAgICAgaWYgKGZvdW5kQ29sbGlzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gY29sU3BhbjtcbiAgICAgICAgfVxuICAgICAgICBjb2xTcGFuKys7XG4gICAgfVxuICAgIHJldHVybiBjb2xTcGFuO1xufVxuZnVuY3Rpb24gcGFja092ZXJsYXBwaW5nRXZlbnRHcm91cChjb2x1bW5zLCBjYWxjdWxhdGVkRXZlbnRzLCBwb3B1bGF0ZU9wdGlvbnMpIHtcbiAgICBjb25zdCB7IHNjcmVlbldpZHRoID0gY29uc3RhbnRzLnNjcmVlbldpZHRoLCByaWdodEVkZ2VTcGFjaW5nID0gUklHSFRfRURHRV9TUEFDSU5HLCBvdmVybGFwRXZlbnRzU3BhY2luZyA9IE9WRVJMQVBfRVZFTlRTX1NQQUNJTkdTIH0gPSBwb3B1bGF0ZU9wdGlvbnM7XG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4sIGNvbHVtbkluZGV4KSA9PiB7XG4gICAgICAgIGNvbHVtbi5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsV2lkdGggPSBzY3JlZW5XaWR0aCAtIHJpZ2h0RWRnZVNwYWNpbmc7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW5TcGFuID0gY2FsY0NvbHVtblNwYW4oZXZlbnQsIGNvbHVtbkluZGV4LCBjb2x1bW5zKTtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50TGVmdCA9IChjb2x1bW5JbmRleCAvIGNvbHVtbnMubGVuZ3RoKSAqIHRvdGFsV2lkdGg7XG4gICAgICAgICAgICBsZXQgZXZlbnRXaWR0aCA9IHRvdGFsV2lkdGggKiAoY29sdW1uU3BhbiAvIGNvbHVtbnMubGVuZ3RoKTtcbiAgICAgICAgICAgIGlmIChjb2x1bW5JbmRleCArIGNvbHVtblNwYW4gPD0gY29sdW1ucy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgZXZlbnRXaWR0aCAtPSBvdmVybGFwRXZlbnRzU3BhY2luZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGN1bGF0ZWRFdmVudHMucHVzaChidWlsZEV2ZW50KGV2ZW50LCBldmVudExlZnQsIGV2ZW50V2lkdGgsIHBvcHVsYXRlT3B0aW9ucykpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwb3B1bGF0ZUV2ZW50cyhfZXZlbnRzLCBwb3B1bGF0ZU9wdGlvbnMpIHtcbiAgICBsZXQgbGFzdEVuZCA9IG51bGw7XG4gICAgbGV0IGNvbHVtbnMgPSBbXTtcbiAgICBjb25zdCBjYWxjdWxhdGVkRXZlbnRzID0gW107XG4gICAgY29uc3QgZXZlbnRzID0gX2V2ZW50c1xuICAgICAgICAubWFwKChldiwgaW5kZXgpID0+ICh7IC4uLmV2LCBpbmRleDogaW5kZXggfSkpXG4gICAgICAgIC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIGlmIChhLnN0YXJ0IDwgYi5zdGFydClcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgaWYgKGEuc3RhcnQgPiBiLnN0YXJ0KVxuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIGlmIChhLmVuZCA8IGIuZW5kKVxuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICBpZiAoYS5lbmQgPiBiLmVuZClcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9KTtcbiAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgLy8gUmVzZXQgcmVjZW50IG92ZXJsYXBwaW5nIGV2ZW50IGdyb3VwIGFuZCBzdGFydCBhIG5ldyBvbmVcbiAgICAgICAgaWYgKGxhc3RFbmQgIT09IG51bGwgJiYgZXYuc3RhcnQgPj0gbGFzdEVuZCkge1xuICAgICAgICAgICAgcGFja092ZXJsYXBwaW5nRXZlbnRHcm91cChjb2x1bW5zLCBjYWxjdWxhdGVkRXZlbnRzLCBwb3B1bGF0ZU9wdGlvbnMpO1xuICAgICAgICAgICAgY29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgbGFzdEVuZCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGxhY2UgY3VycmVudCBldmVudCBpbiB0aGUgcmlnaHQgY29sdW1uIHdoZXJlIGl0IGRvZXNuJ3Qgb3ZlcmxhcFxuICAgICAgICBsZXQgcGxhY2VkID0gZmFsc2U7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY29sID0gY29sdW1uc1tpXTtcbiAgICAgICAgICAgIGlmICghaGFzQ29sbGlzaW9uKGNvbFtjb2wubGVuZ3RoIC0gMV0sIGV2KSkge1xuICAgICAgICAgICAgICAgIGNvbC5wdXNoKGV2KTtcbiAgICAgICAgICAgICAgICBwbGFjZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIGN1cnIgZXZlbnQgd2Fzbid0IHBsYWNlZCBpbiBhbnkgb2YgdGhlIGNvbHVtbnMsIGNyZWF0ZSBhIG5ldyBjb2x1bW4gZm9yIGl0XG4gICAgICAgIGlmICghcGxhY2VkKSB7XG4gICAgICAgICAgICBjb2x1bW5zLnB1c2goW2V2XSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3RFbmQgPT09IG51bGwgfHwgZXYuZW5kID4gbGFzdEVuZCkge1xuICAgICAgICAgICAgbGFzdEVuZCA9IGV2LmVuZDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChjb2x1bW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGFja092ZXJsYXBwaW5nRXZlbnRHcm91cChjb2x1bW5zLCBjYWxjdWxhdGVkRXZlbnRzLCBwb3B1bGF0ZU9wdGlvbnMpO1xuICAgIH1cbiAgICByZXR1cm4gY2FsY3VsYXRlZEV2ZW50cztcbn1cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFVuYXZhaWxhYmxlSG91cnNCbG9ja3ModW5hdmFpbGFibGVIb3VycyA9IFtdLCBvcHRpb25zKSB7XG4gICAgY29uc3QgeyBob3VyQmxvY2tIZWlnaHQgPSBIT1VSX0JMT0NLX0hFSUdIVCwgZGF5U3RhcnQgPSAwLCBkYXlFbmQgPSAyNCB9ID0gb3B0aW9ucyB8fCB7fTtcbiAgICBjb25zdCB0b3RhbERheUhvdXJzID0gZGF5RW5kIC0gZGF5U3RhcnQ7XG4gICAgY29uc3QgdG90YWxEYXlIZWlnaHQgPSAoZGF5RW5kIC0gZGF5U3RhcnQpICogaG91ckJsb2NrSGVpZ2h0O1xuICAgIHJldHVybiAodW5hdmFpbGFibGVIb3Vyc1xuICAgICAgICAubWFwKGhvdXJzID0+IHtcbiAgICAgICAgaWYgKCFpblJhbmdlKGhvdXJzLnN0YXJ0LCAwLCAyNSkgfHwgIWluUmFuZ2UoaG91cnMuZW5kLCAwLCAyNSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhbGVuZGFyIFRpbWVsaW5lIHVuYXZhaWxhYmxlSG91cnMgaXMgaW52YWxpZC4gSG91cnMgc2hvdWxkIGJlIGJldHdlZW4gMCBhbmQgMjQnKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhvdXJzLnN0YXJ0ID49IGhvdXJzLmVuZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ2FsZW5kYXIgVGltZWxpbmUgYXZhaWxhYmxlSG91cnMgaXMgaW52YWxpZC4gc3RhcnQgaG91ciBzaG91bGQgYmUgZWFybGllciB0aGFuIGVuZCBob3VyJyk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXJ0Rml4ZWQgPSBNYXRoLm1heChob3Vycy5zdGFydCwgZGF5U3RhcnQpO1xuICAgICAgICBjb25zdCBlbmRGaXhlZCA9IE1hdGgubWluKGhvdXJzLmVuZCwgZGF5RW5kKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogKChzdGFydEZpeGVkIC0gZGF5U3RhcnQpIC8gdG90YWxEYXlIb3VycykgKiB0b3RhbERheUhlaWdodCxcbiAgICAgICAgICAgIGhlaWdodDogKGVuZEZpeGVkIC0gc3RhcnRGaXhlZCkgKiBob3VyQmxvY2tIZWlnaHRcbiAgICAgICAgfTtcbiAgICB9KVxuICAgICAgICAvLyBOb3RlOiB0aGlzIGZpbHRlciBmYWxzeSB2YWx1ZXMgKHVuZGVmaW5lZCBibG9ja3MpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbikpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLFFBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNB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