{"version":3,"names":["_NativeReanimated","_interopRequireDefault","require","_core","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty3","default","getOwnPropertyDescriptors","defineProperties","defineProperty","jsListener","eventName","handler","evt","nativeEvent","WorkletEventHandler","worklet","_classCallCheck2","eventNames","undefined","_defineProperty","reattachNeeded","listeners","viewTag","registrations","NativeReanimatedModule","native","reduce","acc","_createClass2","key","value","updateWorklet","newWorklet","registerForEvents","fallbackEventName","_this","map","registerEventHandler","unregisterFromEvents","id","unregisterEventHandler","exports"],"sources":["WorkletEventHandler.ts"],"sourcesContent":["import { NativeEvent } from './commonTypes';\nimport NativeReanimatedModule from './NativeReanimated';\nimport { registerEventHandler, unregisterEventHandler } from './core';\n\nfunction jsListener<T extends NativeEvent<T>>(\n  eventName: string,\n  handler: (event: T) => void\n) {\n  return (evt: T) => {\n    handler({ ...evt.nativeEvent, eventName });\n  };\n}\n\nexport default class WorkletEventHandler<T extends NativeEvent<T>> {\n  worklet: (event: T) => void;\n  eventNames: string[];\n  reattachNeeded: boolean;\n  listeners: Record<string, (event: T) => void>;\n  viewTag: number | undefined;\n  registrations: string[];\n  constructor(worklet: (event: T) => void, eventNames: string[] = []) {\n    this.worklet = worklet;\n    this.eventNames = eventNames;\n    this.reattachNeeded = false;\n    this.listeners = {};\n    this.viewTag = undefined;\n    this.registrations = [];\n\n    if (!NativeReanimatedModule.native) {\n      this.listeners = eventNames.reduce(\n        (acc: Record<string, (event: T) => void>, eventName: string) => {\n          acc[eventName] = jsListener(eventName, worklet);\n          return acc;\n        },\n        {}\n      );\n    }\n  }\n\n  updateWorklet(newWorklet: (event: T) => void): void {\n    this.worklet = newWorklet;\n    this.reattachNeeded = true;\n  }\n\n  registerForEvents(viewTag: number, fallbackEventName?: string): void {\n    this.viewTag = viewTag;\n    this.registrations = this.eventNames.map((eventName) =>\n      registerEventHandler(viewTag + eventName, this.worklet)\n    );\n    if (this.registrations.length === 0 && fallbackEventName) {\n      this.registrations.push(\n        registerEventHandler(viewTag + fallbackEventName, this.worklet)\n      );\n    }\n  }\n\n  unregisterFromEvents(): void {\n    this.registrations.forEach((id) => unregisterEventHandler(id));\n    this.registrations = [];\n  }\n}\n"],"mappings":"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"}